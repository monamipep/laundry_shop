<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Dashboard | Laundry Shop</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f2f5;
      margin: 40px 10px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2, h3 { color: #333; margin-top: 0; }
    .logout {
      float: right;
      color: red;
      text-decoration: none;
      font-weight: bold;
    }
    .logout:hover { text-decoration: underline; }
    .laundry-types {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin: 15px 0;
    }
    .laundry-option {
      flex: 1 1 150px;
      text-align: center;
      border: 2px solid #ccc;
      border-radius: 12px;
      padding: 15px;
      cursor: pointer;
      transition: 0.3s;
    }
    .laundry-option:hover {
      border-color: #007bff;
      background: #eef5ff;
    }
    .laundry-option.selected {
      border-color: #007bff;
      background: #dce9ff;
    }
    .laundry-option img {
      width: 70px;
      height: 70px;
      object-fit: contain;
      margin-bottom: 10px;
    }
    .laundry-option input { display: none; }

    input, button {
      padding: 8px;
      margin: 5px 0;
      width: 100%;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    button {
      background: #007bff;
      border: none;
      color: white;
      cursor: pointer;
      font-weight: bold;
      border-radius: 6px;
      transition: 0.3s;
    }
    button:hover { background: #0056b3; }

    .pickup-section {
      margin-top: 15px;
      padding: 12px;
      background: #f9f9f9;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    #pickupDetails {
      display: none;
      margin-top: 10px;
    }

    #pricePreview {
      font-weight: bold;
      color: green;
      margin: 10px 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 14px;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ccc;
      text-align: center;
    }
    th {
      background: #2b2b2b;
      color: white;
    }
    tr:nth-child(even) { background: #f9f9f9; }

    @media (max-width: 700px) {
      .laundry-types { flex-direction: column; }
      .laundry-option { width: 100%; }
      body { margin: 20px 5px; }
    }
  </style>
</head>
<body>

<div class="container">
  <h2>Welcome, {{ user.username }} üëã</h2>
  <a href="/logout" class="logout">Logout</a>
  <hr>

  <h3>Place a New Laundry Order</h3>
  <form method="POST" action="/place_order">
    <label><b>Select Laundry Type:</b></label>
    <div class="laundry-types">
      <label class="laundry-option">
        <input type="radio" name="laundry_type" value="Wash-Dry-Fold" data-price="23" required>
        <img src="/static/img/wash.png" alt="Wash Dry Fold">
        <div>Wash-Dry-Fold<br><small>‚Ç±23/kg</small></div>
      </label>
      <label class="laundry-option">
        <input type="radio" name="laundry_type" value="Wash-Dry-Press" data-price="60">
        <img src="/static/img/press.png" alt="Wash Dry Press">
        <div>Wash-Dry-Press<br><small>‚Ç±60/kg</small></div>
      </label>
      <label class="laundry-option">
        <input type="radio" name="laundry_type" value="Press Only" data-price="40">
        <img src="/static/img/iron.png" alt="Press Only">
        <div>Press Only<br><small>‚Ç±40/kg</small></div>
      </label>
      <label class="laundry-option">
        <input type="radio" name="laundry_type" value="Special Items" data-price="70">
        <img src="/static/img/special.png" alt="Special Items">
        <div>Special Items<br><small>‚Ç±70/kg</small></div>
      </label>
    </div>

    <label>Weight (kg):</label>
    <input type="number" name="weight" step="0.1" min="0.5" required>

    <div class="pickup-section">
      <label><b>Would you like Pickup + Drop-off Service?</b></label><br>
      <input type="checkbox" id="pickupCheck" name="pickup_requested">
      Yes, pickup & deliver back to my unit (+‚Ç±20)
      
      <div id="pickupDetails">
        <label>Floor Number:</label>
        <input type="text" name="floor_number" placeholder="e.g., 8th Floor">
        <label>Unit Number:</label>
        <input type="text" name="unit_number" placeholder="e.g., Room 804">
      </div>
    </div>

    <p id="pricePreview"></p>

    <button type="submit">Submit Order</button>
  </form>

  <h3>My Laundry Orders</h3>
  <table>
    <tr>
      <th>ID</th>
      <th>Type</th>
      <th>Weight</th>
      <th>Price</th>
      <th>Pickup + Drop-off</th>
      <th>Status</th>
      <th>Date Created</th>
    </tr>
    {% for o in orders %}
    <tr>
      <td>{{ o.id }}</td>
      <td>{{ o.laundry_type }}</td>
      <td>{{ o.weight_kg }} kg</td>
      <td>‚Ç±{{ "%.2f"|format(o.price) }}</td>
      <td>
        {% if o.pickup_requested %}
          Yes<br><small>Floor {{ o.floor_number }}, Unit {{ o.unit_number }}</small>
        {% else %}
          No
        {% endif %}
      </td>
      <td>{{ o.status }}</td>
      <td>{{ o.date_created.strftime('%Y-%m-%d %H:%M') }}</td>
    </tr>
    {% else %}
    <tr><td colspan="7">No orders yet.</td></tr>
    {% endfor %}
  </table>
</div>

<!-- Pickup Validation & Price Script -->
<script>
  const form = document.querySelector('form');
  const weightInput = document.querySelector('input[name="weight"]');
  const pricePreview = document.getElementById('pricePreview');
  const pickupCheck = document.getElementById('pickupCheck');
  const pickupDetails = document.getElementById('pickupDetails');
  let selectedPricePerKg = 0;

  // Laundry type selection
  document.querySelectorAll('.laundry-option input').forEach(input => {
    input.addEventListener('change', () => {
      document.querySelectorAll('.laundry-option').forEach(opt => opt.classList.remove('selected'));
      input.closest('.laundry-option').classList.add('selected');
      selectedPricePerKg = parseFloat(input.dataset.price);
      updatePricePreview();
    });
  });

  // Update price dynamically
  weightInput.addEventListener('input', updatePricePreview);
  pickupCheck.addEventListener('change', () => {
    pickupDetails.style.display = pickupCheck.checked ? 'block' : 'none';
    if (!pickupCheck.checked) {
      pickupDetails.querySelectorAll('input').forEach(i => i.value = '');
    }
    updatePricePreview();
  });

  function updatePricePreview() {
    const weight = parseFloat(weightInput.value);
    if (!isNaN(weight) && selectedPricePerKg > 0) {
      let total = weight * selectedPricePerKg;
      if (pickupCheck.checked) total += 20;
      pricePreview.textContent = `Estimated Price: ‚Ç±${total.toFixed(2)} (${selectedPricePerKg}/kg${pickupCheck.checked ? ' + ‚Ç±20 pickup & drop-off' : ''})`;
    } else {
      pricePreview.textContent = '';
    }
  }

  // ‚úÖ Custom modal popup
  function showModal(message, onConfirm) {
    const modal = document.createElement("div");
    modal.innerHTML = `
      <div id="confirmModal" style="
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.5);
        display: flex; align-items: center; justify-content: center;
        z-index: 9999;
      ">
        <div style="
          background: white;
          padding: 25px 30px;
          border-radius: 12px;
          width: 340px;
          text-align: center;
          box-shadow: 0 5px 20px rgba(0,0,0,0.25);
          animation: fadeIn 0.25s ease;
        ">
          <h3 style="color: #e67e22; margin: 0 0 10px 0;">‚ö†Ô∏è Attention</h3>
          <p style="color: #333; font-size: 15px; margin-bottom: 20px;">${message}</p>
          <div style="display:flex; justify-content:center; gap:10px;">
            <button id="cancelBtn" style="
              background: #ccc;
              color: black;
              border: none;
              padding: 7px 15px;
              border-radius: 6px;
              cursor: pointer;
              font-weight: bold;
            ">OK</button>
          </div>
        </div>
      </div>
    `;
    document.body.appendChild(modal);
    document.getElementById("cancelBtn").addEventListener("click", () => modal.remove());
  }

  // ‚úÖ Form validation
  form.addEventListener('submit', function (e) {
    if (pickupCheck.checked) {
      const floor = document.querySelector('input[name="floor_number"]').value.trim();
      const unit = document.querySelector('input[name="unit_number"]').value.trim();
      if (floor === '' || unit === '') {
        e.preventDefault();
        showModal("Please enter both <b>Floor Number</b> and <b>Unit Number</b> for pickup & drop-off service.");
        return false;
      }
    }
  });
</script>

<style>
  @keyframes fadeIn {
    from { transform: scale(0.9); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }
</style>


<style>
  @keyframes pop {
    from { transform: scale(0.9); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }
</style>


</body>
</html>
